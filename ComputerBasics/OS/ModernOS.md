# 现代操作系统



# 概述

> **复习大纲：**
>
> 1. 操作系统的基本概念、基本功能；
>2. 分时系统、批处理系统、实时系统的主要特征；
> 3. 用户接口、系统调用过程
>4. 单道与多道程序技术；
> 5. 操作系统虚拟机体系结构
>6. CPU工作模式；



## 概念 / 功能

<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c17c21686f21413085f3e32c85a19443~tplv-k3u1fbpfcp-watermark.awebp" style="zoom:67%;" >

+ 资源管理者
  +  处理机管理 
  +  内存管理
  +  设备管理
  +  文件管理 
+ 扩展机器
  + 用户接口

**两个基本功能：**资源管理者，扩展机器

**主要功能：**处理机管理，内存管理，设备管理，文件管理，用户接口

**特征：**并发性，共享性，虚拟性，异步性

**两个基本特征**：并发性，共享性



## 几种操作系统

> 分时系统、批处理系统、实时系统 的主要特征

**批处理系统：**

+ 多道性、并发性、无序性、调度性

+ 无交互能力、作业平均周转周期长

**分时系统：**（时间片轮转）

+ 多路性、交互性、独占性、及时性

**实时系统**



## 单道与多道程序技术

**多道程序设计：**

+ 概念：CPU在内存中多个进程之间迅速切换，使得多道程序能并发执行
+ 多道程序设计技术是**现代操作系统诞生的标志**



## 用户接口

> 用户接口、系统调用过程

**CPU 两种工作模式：**用户态（仅允许执行部分指令和功能），内核态

+ 特权指令只能在内核态下执行

+ 因此用户程序必须通过 <span style="color:orange">系统调用</span> 陷入内核调用 OS 相关服务

**系统调用过程：**

1. Trap 指令，切换至内核态



## 体系结构

> 操作系统虚拟机体系结构

==。。。==



## CPU工作模式

==。。。==



# 进程与线程

> **复习大纲：**
>
> 1. 进程的基本概念、并发与并行；
>
> 2. 线程的基本概念
>
> 3. 进程与程序、进程与线程的区别与联系
>
> 4. 进程的实现（PCB）、线程的实现（TCB）；
>
> 5. 进程的状态及其转换；
>
> 6. 进程控制原语
>
> 7. 临界资源、临界区概念；
>
> 8. 进程通信的方式；
>
> 9. 进程的同步与互斥信号量实现；
>
> 10. 调度目标与常用的作业及进程调度算法；

**关系：**

一个进程可有多个线程

线程可并发执行

线程是调度的独立单位，资源分配给进程，同一进程所有线程共享该资源



## 进程

> 进程的基本概念、并发与并行

**进程：** **资源分配**的基本单位

**并发与并行：**

都是 CPU 执行多个任务的方式

并发：只有一个 CPU，在同一时间点，任务并不会同时运行，只是用**时间片轮转实现了宏观上**一个时间段内多个任务同时运行的效果

- 有竞争关系

并行：同一时刻多个任务同时执行。多个 CPU 实现

- 无竞争关系



## 线程

> 线程的基本概念

**概念：**进程的一个执行单元，是**独立调度**的基本单位



## 进程与程序, 进程与线程

> 进程与程序、进程与线程 的区别与联系

<span style="font-size:20px">进程与程序</span>

联系：一个程序生成多个进程

区别：程序不具备 动态，并发，独立，异步，结构



<span style="font-size:20px">进程与线程</span>

联系：线程依赖于进程，进程中使用多线程并行处理提高效率

区别：

- 系统开销：系统创建、撤销进程的开销远大于对线程的开销
- 通信：同一进程的线程间可直接读写；进程间通信需借助 IPC（进程间通信）



## 进程 / 线程 的实现

>  进程的实现（PCB 进程控制块）、线程的实现（TCB 线程控制块）

<span style="font-size:20px">进程的实体</span>

+ **进程的内存空间：**

  - 数据段——进程的全局变量和静态变量

  - 代码段

  - 堆栈段——栈存储函数调用信息；堆存储动态分配的内存

+ 进程表表项（进程控制块 **PCB**）

+ 正在执行的进程和 CPU 现场

<span style="font-size:20px">PCB 的实现</span>（Process Control Block）

**PCB 字段：**

+ 进程管理
+ 存储管理
+ 文件管理

**PCB 组织方式：**（组织多个 PCB）

+ 链接组织方式
+ 索引组织方式

<span style="font-size:20px">线程的实现：</span>

+ 用户空间中实现
+ 内核中实现
+ 混合实现



## 进程的状态及转换

![img](https://upload.wikimedia.org/wikipedia/commons/thumb/8/83/Process_states.svg/400px-Process_states.svg.png)

+ 就绪 **waiting**——等待调度；运行 **running**；阻塞 **blocked**——等待资源

  waiting——可运行，但因为其他进程正在运行而暂时停止

  runnning——占用 CPU

  blocked——除非某种外部事件发生，否则进程不能运行



## 进程控制原语

进程创建 `create()`

进程终止 `exit()`

进程阻塞 `block()`

进程唤醒 `wakeup()`



## 临界资源、临界区

> 临界资源、临界区概念

**临界资源：**一次只允许一个进程使用的 软硬件资源

**临界区：**在每个进程中，访问临界资源（共享内存）的那部 分代码（那段程序）



## 进程间通信

> 1. 进程通信的方式
>
> 2. 进程的同步与互斥信号量实现

<span style="font-size:20px">基本概念</span>

**制约关系：**

+ 进程互斥（间接相互制约）：进程竞争共享——另一必须等待
+ 进程同步（直接相互制约）：进程间合作——相互协调

**中断：**响应硬件设备请求的一种机制



<span style="font-size:20px">解决进程互斥:</span>

+ **屏蔽中断：**进程进入临界区后先关中 断，离开前开中断

+ **加锁法：**锁变量来表示临界区是否可用

+ **严格轮换法**
+ **Peterson 解决方案**
+ **TSL 指令**

 

### IPC

Inter Process Communication——进程通信

<span style="font-size:20px; color:red">信号量 - Semaphore</span>

值仅由 `down` / P, `up` / V **原语改变**

**物理意义：**s >= 0: 可使用资源数；s < = 等待使用资源的进程数

`P(S)` 申请一个资源；`V(S)` 释放一个资源

**复杂情况：** 一个同步 P 操作与一个互斥 P 操作在一起时,同步 P 在互斥 P 前



<span style="font-size:20px">管程 - Monitor</span>

**概念：**更高级的同步原语，进入管程的互斥由编译器负责，使用者只需将临界区转换为管程

**特性：**任一时刻管程中只能有一个活跃进程



<span style="font-size:20px">消息传递 - Message Passing：</span>

**实现：**两个原语 `send`, `receive`

...



## 调度

> 调度目标与常用的作业及进程调度算法

**调度目标：**

+ 低级调度 / 处理机调度（进程调度）
+ 中级调度 / 内存调度
+ 高级调度 / 作业调度



**性能评价指标：**

+ 平均周转时间 T: 每一任务完成 - 提交时间 之和 $\frac{1}{n} \sum{T_i}$

+ 平均带权周转时间 T' : $\frac{1}{n} \sum{T_i^1}$

+ 平均等待时间 W : $\frac{1}{n} \sum{W_i}$



<span style="font-size:20px;color:red">调度算法</span>

**先来先服务 FCFS**

**最短作业优先 SJF**

**轮转调度 RR：**时间片 q

**优先级调度**

**多级队列调度**



# 死锁

> **考试大纲：**
>
> 1. 死锁的概念
> 2. 死锁产生的原因及必要条件
> 3. 死锁问题的四个解决策略
> 4. 安全状态的定义、银行家算法



## 概念

> 死锁的概念

**死锁：**一个进程集合中的每个进程都在等待只能由该进程集合中的其他进程才能引发的事件

**不可抢占资源：**从拥有它的进程中抢占将引起相关计算的失败



## 产生原因 ，必要条件

> 死锁产生的原因及必要条件

**形成死锁**四个**必要条件：**

1. 互斥
2. 占有和等待
3. 不可抢占资源
4. 环路等待：存在一条环路，该环路中的每一个进程都在等待下一个进程所占有的资源



## 解决策略

> 死锁问题的四个解决策略

**鸵鸟算法：**（忽略死锁）

**解除死锁**

1. 死锁检测
2. 死锁恢复
   + 抢占
   + 回滚
   + 杀死进程

通过资源分配 **死锁避免：**动态分配资源时防止系统进入不安全状态

+ 银行家算法：进程预先告知自己的最大资源需求

破坏必要条件 **防止死锁** 产生



## 安全状态，银行家算法

> 安全状态的定义、银行家算法

**安全状态：**现有的资源占有情况下，按照某推进顺序仍可使每个进程得到其对资源的最大需求



<span style="color:red">**银行家算法**</span>

==。。。==



# 存储管理

> **考试大纲：**
>
> 1. 分页存储管理方式原理及地址映射过程
> 2. 虚拟存储技术（覆盖、交换）
>
> 3. 物理内存管理方式（位图、空闲链表）
>
> 4. 页表组成、TLB、页的大小
>
> 5. 常用页面置换算法及缺页率计算（FIFO，LRU，时钟页面置换算法）
>
> 6. 段式与页式存储管理方式的主要区别



## 分页存储管理方式, 地址映射

> 分页存储管理方式原理及地址映射过程



<span style="font-size:20px">地址映射</span>（重定位）

从逻辑地址到物理地址的地址映射



## 虚拟存储技术

> 虚拟存储技术（覆盖、交换）

**内存超载 解决方案：**

+ 交换——进程完整 调入内存，使该进程运行一段时间，然后把 它调回磁盘
+ 覆盖——程序按逻辑覆盖
+ 虚拟内存



<span style="font-size:20px">虚拟内存</span>

处理内存超载的重要技术

基本思想：每个进程拥有自己的地址空间，分割成多个大小相等的块，每一块称作页。让部分页进驻内存也能顺利执行

技术基础：离散内存分配。进程的<span style="color:orange">逻辑地址空间分散存储</span>在内存不连续的<span style="color:orange">物理地址空间</span>



## 物理内存管理方式

> 物理内存管理方式（位图、空闲链表）

<span style="font-size:20px">位图</span>

内存划分成一定大小的分配单元，每 个单元对应位图中的一位



<span style="font-size:20px">空闲链表</span>



## 页

> 页表组成、TLB、页的大小

<span style="font-size:20px">页表</span>

**页表**给出 虚拟地址 与 物理地址 之间 的映射关系

**MMU：**内存管理单元，完成地址映射。

+ CPU 发送 虚拟地址 给 MMU
+ MMU 发送 物理地址 给 存储器



<span style="font-size:20px">TLB</span>

用于**加速分页**，存储少量 页表项 的相关信息

**TLB：**Translation Lookaside buffer 转换检测缓冲区。通常在 MMU 中



## 页面置换算法

> 常用页面置换算法及缺页率计算（FIFO，LRU，时钟页面置换算法）

**场景：**

1. 访问页不在内存，引起**缺页中断**
2. 无空闲页框
3. **页面置换** 选择一个页面换出，为即将调入内存的页面腾出空间



<span style="font-size:20px">FIFO</span> ——先进先出页面置换算法

OS 维护一个 所有当前在内存中页面 的 <span style="color:orange">链表</span>

在 表头 的最久进入页 被置换出内存



<span style="font-size:20px">LRU</span> ——最近最少使用页面置换算法

<span style="color:orange">链表</span>



<span style="font-size:20px">Clock</span>——时钟页面置换算法

<span style="color:orange">环形链表</span>，表针指向最老页面

置换时检查表头页面的访问位 R



## 段式与页式 区别

> 段式与页式存储管理方式的主要区别

+ 页是信息的<span style="color:orange">物理单位</span>，段是信息的<span style="color:orange">**逻辑单位**</span>， 分页是系统管理的需要，分段是用户的需要

+ 页大小固定；段**大小动态变化**
+ 分段系统 **二维逻辑地址空间**；分页系统一维
+ 分段易实现 **共享和动态链接**



# 文件系统

> **考试大纲：**
>
> 1. 文件的逻辑结构、物理结构
>
> 2. 文件FCB、文件目录及实现、目录文件
>
> 3. 文件的共享方式
>
> 4. 文件文件系统的可靠性
>
> 5. 文件系统的性能
>
> 6. ==?== 的磁盘空间管理成组链接法

