# 现代操作系统



# 概述

> **复习大纲：**
>
> 1. 操作系统的基本概念、基本功能；
>2. 分时系统、批处理系统、实时系统的主要特征；
> 3. 用户接口、系统调用过程
>4. 单道与多道程序技术；
> 5. 操作系统虚拟机体系结构
>6. CPU工作模式；



## 概念/功能

+ 资源管理者
  +  处理机管理 
  +  内存管理
  +  设备管理
  +  文件管理 
+ 扩展机器
  + 用户接口

**两个基本功能：**资源管理者，扩展机器

**主要功能：**处理机管理，内存管理，设备管理，文件管理，用户接口

**特征：**并发性，共享性，虚拟性，异步性

**两个基本特征**：并发性，共享性



## 几种操作系统

> 分时系统、批处理系统、实时系统 的主要特征

**批处理系统：**

+ 多道性、并发性、无序性、调度性

+ 无交互能力、作业平均周转周期长

**分时系统：**（时间片轮转）

+ 多路性、交互性、独占性、及时性

**实时系统**



## 单道与多道程序技术

**多道程序设计：**

+ 概念：CPU在内存中多个进程之间迅速切换，使得多道程序能并发执行
+ 多道程序设计技术是**现代操作系统诞生的标志**



## 用户接口

> 用户接口、系统调用过程

**CPU 两种工作模式：**用户态（仅允许执行部分指令和功能），内核态

+ 特权指令只能在内核态下执行

+ 因此用户程序必须通过 <span style="color:orange">系统调用</span> 陷入内核调用 OS 相关服务

**系统调用过程：**

1. Trap 指令，切换至内核态



## 体系结构

> 操作系统虚拟机体系结构

==。。。==



## CPU工作模式

==。。。==



# 进程与线程

> **复习大纲：**
>
> 1. 进程的基本概念、并发与并行；
>
> 2. 线程的基本概念
>
> 3. 进程与程序、进程与线程的区别与联系
>
> 4. 进程的实现（PCB）、线程的实现（TCB）；
>
> 5. 进程的状态及其转换；
>
> 6. 进程控制原语
>
> 7. 临界资源、临界区概念；
>
> 8. 进程通信的方式；
>
> 9. 进程的同步与互斥信号量实现；
>
> 10. 调度目标与常用的作业及进程调度算法；

**关系：**

一个进程可有多个线程

线程可并发执行

线程是调度的独立单位，资源分配给进程，同一进程所有线程共享该资源



## 进程

> 进程的基本概念、并发与并行

**进程：** **资源分配**的基本单位

**并发与并行：**

都是 CPU 执行多个任务的方式

并发：只有一个 CPU，在同一时间点，任务并不会同时运行，只是用**时间片轮转实现了宏观上**一个时间段内多个任务同时运行的效果

- 有竞争关系

并行：同一时刻多个任务同时执行。多个 CPU 实现

- 无竞争关系



## 线程

> 线程的基本概念

**概念：**进程的一个执行单元，是**独立调度**的基本单位



## 进程与程序, 进程与线程

> 进程与程序、进程与线程 的区别与联系

<span style="font-size:20px">进程与程序</span>

联系：一个程序生成多个进程

区别：程序不具备 动态，并发，独立，异步，结构



<span style="font-size:20px">进程与线程</span>

联系：线程依赖于进程，进程中使用多线程并行处理提高效率

区别：

- 系统开销：系统创建、撤销进程的开销远大于对线程的开销
- 通信：同一进程的线程间可直接读写；进程间通信需借助 IPC（进程间通信）



## 进程 / 线程 的实现

>  进程的实现（PCB）、线程的实现（TCB）

<span style="font-size:20px">进程的实体</span>

+ **进程的内存空间：**

  - 数据段——进程的全局变量和静态变量

  - 代码段

  - 堆栈段——栈存储函数调用信息；堆存储动态分配的内存

+ 进程表表项（进程控制块 **PCB**）

+ 正在执行的进程和 CPU 现场



<span style="font-size:20px">PCB 的实现</span>（Process Control Block）

PCB 



## 进程间通信

**基本概念：**

临界资源 / 竞争条件：一次只允许一个进程使用的软硬件资源

临界区：进程中访问临界资源的部分代码

制约关系：

+ 进程互斥（间接相互制约）：进程竞争共享——另一必须等待
+ 进程同步（直接相互制约）：进程间合作——相互协调



### 相关概念

+ <span style="font-size:20px">竞争条件：</span>

  多个进程同时读写共享的数据。

+ <span style="font-size:20px">临界区：</span>

  **临界区：**对共享内存进行访问的程序片段

  使两个进程不同时处于临界区中就能避免竞争条件

  使用临界区的互斥如图：

  <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bb1dffc1075d42eeb00619ea4fe3e8b1~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp" alt="img" style="zoom: 50%;" />

### IPC

Inter Process Communication——进程通信

+ <span style="font-size:20px">消息传递——Message Passing：</span>

  进程间实现通信和同步等待的机制

+ <span style="font-size:20px">管道：</span>

  半双工的通信，数据只能单向流动

+ ...



## 进程状态的切换

![img](https://upload.wikimedia.org/wikipedia/commons/thumb/8/83/Process_states.svg/400px-Process_states.svg.png)

![image-20220417132959182](https://gitee.com/ethereal-bang/images/raw/master/20220417133006.png)

+ 就绪 **waiting**——等待调度；运行 **running**；阻塞 **blocked**——等待资源

  waiting——可运行，但因为其他进程正在运行而暂时停止

  runnning——占用 CPU

  blocked——除非某种外部事件发生，否则进程不能运行
